package news.vodaUUru;

import com.google.gson.Gson;
import news.Model;
import news.NewsItem;
import news.NewsPage;
import news.PageRequest;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;
import utils.ConstantManager;

import java.io.IOException;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.*;

public class VodaUU implements Model {
    private DateFormat dateFormat = new SimpleDateFormat("dd MMMM");

    @Override
    public NewsItem[] getItems(String searchWord) throws Exception {
        Document document = getDocument(ConstantManager.VODA_UU_RU);
        String message = document.getElementsByTag("script").get(15).html().split("\n")[1];
        message = message.replaceFirst("objects:", "").trim();
        message = message.substring(0, message.length() - 1);
        //message = "{\"14 Сентября\":[{\"coordinates\":[61.374544,55.142154],\"name\":\"Трашутина ул 20\",\"content\":\"Черничная 16 течь из земли на водоводе д-300 - Аварийные <br> Плановое время отключения:  <br> Плановое время включения:  <br> Фактическое время отключения: 08.09.2017 17:10:00 <br> Фактическое время включения: 14.09.2017 19:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Черничная ул ч\\/сектор\",\"content\":\"Черничная 16 течь из земли на водоводе д-300 - Аварийные <br> Плановое время отключения:  <br> Плановое время включения:  <br> Фактическое время отключения: 08.09.2017 17:10:00 <br> Фактическое время включения: 14.09.2017 19:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Трудовая ул 16\",\"content\":\"Трудовая 4 ремонтные работы на водоводе д-100. - Плановые <br> Плановое время отключения: 14.09.2017 10:00:00 <br> Плановое время включения: 14.09.2017 12:00:00 <br> Фактическое время отключения: 14.09.2017 10:30:00 <br> Фактическое время включения: 14.09.2017 13:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Дегтярева ул 19\",\"content\":\"Трудовая 4 ремонтные работы на водоводе д-100. - Плановые <br> Плановое время отключения: 14.09.2017 10:00:00 <br> Плановое время включения: 14.09.2017 12:00:00 <br> Фактическое время отключения: 14.09.2017 10:30:00 <br> Фактическое время включения: 14.09.2017 13:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Дегтярева ул 21\",\"content\":\"Трудовая 4 ремонтные работы на водоводе д-100. - Плановые <br> Плановое время отключения: 14.09.2017 10:00:00 <br> Плановое время включения: 14.09.2017 12:00:00 <br> Фактическое время отключения: 14.09.2017 10:30:00 <br> Фактическое время включения: 14.09.2017 13:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Дегтярева ул 23\",\"content\":\"Трудовая 4 ремонтные работы на водоводе д-100. - Плановые <br> Плановое время отключения: 14.09.2017 10:00:00 <br> Плановое время включения: 14.09.2017 12:00:00 <br> Фактическое время отключения: 14.09.2017 10:30:00 <br> Фактическое время включения: 14.09.2017 13:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Дегтярева ул 24\",\"content\":\"Трудовая 4 ремонтные работы на водоводе д-100. - Плановые <br> Плановое время отключения: 14.09.2017 10:00:00 <br> Плановое время включения: 14.09.2017 12:00:00 <br> Фактическое время отключения: 14.09.2017 10:30:00 <br> Фактическое время включения: 14.09.2017 13:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Дегтярева ул 24а\",\"content\":\"Трудовая 4 ремонтные работы на водоводе д-100. - Плановые <br> Плановое время отключения: 14.09.2017 10:00:00 <br> Плановое время включения: 14.09.2017 12:00:00 <br> Фактическое время отключения: 14.09.2017 10:30:00 <br> Фактическое время включения: 14.09.2017 13:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Дегтярева ул 26\",\"content\":\"Трудовая 4 ремонтные работы на водоводе д-100. - Плановые <br> Плановое время отключения: 14.09.2017 10:00:00 <br> Плановое время включения: 14.09.2017 12:00:00 <br> Фактическое время отключения: 14.09.2017 10:30:00 <br> Фактическое время включения: 14.09.2017 13:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Павелецкая ул 8\",\"content\":\"Трудовая 4 ремонтные работы на водоводе д-100. - Плановые <br> Плановое время отключения: 14.09.2017 10:00:00 <br> Плановое время включения: 14.09.2017 12:00:00 <br> Фактическое время отключения: 14.09.2017 10:30:00 <br> Фактическое время включения: 14.09.2017 13:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Павелецкая ул 10\",\"content\":\"Трудовая 4 ремонтные работы на водоводе д-100. - Плановые <br> Плановое время отключения: 14.09.2017 10:00:00 <br> Плановое время включения: 14.09.2017 12:00:00 <br> Фактическое время отключения: 14.09.2017 10:30:00 <br> Фактическое время включения: 14.09.2017 13:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Павелецкая ул 10а\",\"content\":\"Трудовая 4 ремонтные работы на водоводе д-100. - Плановые <br> Плановое время отключения: 14.09.2017 10:00:00 <br> Плановое время включения: 14.09.2017 12:00:00 <br> Фактическое время отключения: 14.09.2017 10:30:00 <br> Фактическое время включения: 14.09.2017 13:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Павелецкая ул 12\",\"content\":\"Трудовая 4 ремонтные работы на водоводе д-100. - Плановые <br> Плановое время отключения: 14.09.2017 10:00:00 <br> Плановое время включения: 14.09.2017 12:00:00 <br> Фактическое время отключения: 14.09.2017 10:30:00 <br> Фактическое время включения: 14.09.2017 13:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Богдана Хмельницкого ул 22\",\"content\":\"Б.Хмельницкого 22 замена водовода д-100. - Плановые <br> Плановое время отключения: 14.09.2017 13:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 14:15:00 <br> Фактическое время включения: 14.09.2017 21:20:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Богдана Хмельницкого ул 24\",\"content\":\"Б.Хмельницкого 22 замена водовода д-100. - Плановые <br> Плановое время отключения: 14.09.2017 13:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 14:15:00 <br> Фактическое время включения: 14.09.2017 21:20:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Социалистическая ул 44\",\"content\":\"Социалистическая 44 - ревизия задвижки д-100 - Аварийные <br> Плановое время отключения:  <br> Плановое время включения:  <br> Фактическое время отключения: 14.09.2017 09:15:00 <br> Фактическое время включения: 14.09.2017 12:40:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Мира ул 37а\",\"content\":\"Социалистическая 44 - ревизия задвижки д-100 - Аварийные <br> Плановое время отключения:  <br> Плановое время включения:  <br> Фактическое время отключения: 14.09.2017 09:15:00 <br> Фактическое время включения: 14.09.2017 12:40:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Аргаяшская ул \",\"content\":\"ул. Аргаяшская,13 ремонт колодца - Аварийные <br> Плановое время отключения:  <br> Плановое время включения:  <br> Фактическое время отключения: 14.09.2017 09:50:00 <br> Фактическое время включения: 14.09.2017 17:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Тюльпанная ул \",\"content\":\"Татищева 16 врезка регулятора давления - Аварийные <br> Плановое время отключения:  <br> Плановое время включения:  <br> Фактическое время отключения: 14.09.2017 10:50:00 <br> Фактическое время включения: 14.09.2017 17:45:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Гоголя ул \",\"content\":\"ул. Гоголя, 9 для определения повреждения - Аварийные <br> Плановое время отключения:  <br> Плановое время включения:  <br> Фактическое время отключения: 14.09.2017 13:10:00 <br> Фактическое время включения: 14.09.2017 15:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Шаумяна ул \",\"content\":\"ул. Гоголя, 9 для определения повреждения - Аварийные <br> Плановое время отключения:  <br> Плановое время включения:  <br> Фактическое время отключения: 14.09.2017 13:10:00 <br> Фактическое время включения: 14.09.2017 15:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Сосновская ул \",\"content\":\"ул. Гоголя, 9 для определения повреждения - Аварийные <br> Плановое время отключения:  <br> Плановое время включения:  <br> Фактическое время отключения: 14.09.2017 13:10:00 <br> Фактическое время включения: 14.09.2017 15:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Кудрявцева ул 81а\",\"content\":\"Кудрявцева 81а замена водовода - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 19:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 19:40:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Кудрявцева ул 81б\",\"content\":\"Кудрявцева 81а замена водовода - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 19:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 19:40:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Шуменская ул 14\",\"content\":\"Шуменская 14 замена водовода - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 18:00:00 <br> Фактическое время отключения: 14.09.2017 09:05:00 <br> Фактическое время включения: 14.09.2017 19:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Комарова ул 133\",\"content\":\"Шуменская 14 замена водовода - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 18:00:00 <br> Фактическое время отключения: 14.09.2017 09:05:00 <br> Фактическое время включения: 14.09.2017 19:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Комарова ул 133а\",\"content\":\"Шуменская 14 замена водовода - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 18:00:00 <br> Фактическое время отключения: 14.09.2017 09:05:00 <br> Фактическое время включения: 14.09.2017 19:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Комарова ул 133б\",\"content\":\"Шуменская 14 замена водовода - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 18:00:00 <br> Фактическое время отключения: 14.09.2017 09:05:00 <br> Фактическое время включения: 14.09.2017 19:00:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Победы пр-кт 169\",\"content\":\"пр. Победы 169 замена водовода д-150. - Плановые <br> Плановое время отключения: 14.09.2017 10:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:10:00 <br> Фактическое время включения: 14.09.2017 18:45:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Каслинская ул 44\",\"content\":\"пр. Победы 169 замена водовода д-150. - Плановые <br> Плановое время отключения: 14.09.2017 10:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:10:00 <br> Фактическое время включения: 14.09.2017 18:45:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Каслинская ул 46\",\"content\":\"пр. Победы 169 замена водовода д-150. - Плановые <br> Плановое время отключения: 14.09.2017 10:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:10:00 <br> Фактическое время включения: 14.09.2017 18:45:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Каслинская ул 46а\",\"content\":\"пр. Победы 169 замена водовода д-150. - Плановые <br> Плановое время отключения: 14.09.2017 10:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:10:00 <br> Фактическое время включения: 14.09.2017 18:45:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Красного Урала ул 16\",\"content\":\"пр. Победы, 290 замена задвижки д-100 - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:15:00 <br> Фактическое время включения: 14.09.2017 17:45:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Красного Урала ул 18\",\"content\":\"пр. Победы, 290 замена задвижки д-100 - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:15:00 <br> Фактическое время включения: 14.09.2017 17:45:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Красного Урала ул 21\",\"content\":\"пр. Победы, 290 замена задвижки д-100 - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:15:00 <br> Фактическое время включения: 14.09.2017 17:45:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Красного Урала ул 23\",\"content\":\"пр. Победы, 290 замена задвижки д-100 - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:15:00 <br> Фактическое время включения: 14.09.2017 17:45:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Энергетиков ул 28\",\"content\":\"Энергетиков,26 глушение в-да д-50мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 17:00:00 <br> Фактическое время отключения: 14.09.2017 09:15:00 <br> Фактическое время включения: 14.09.2017 11:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Энергетиков ул 28а\",\"content\":\"Энергетиков,26 глушение в-да д-50мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 17:00:00 <br> Фактическое время отключения: 14.09.2017 09:15:00 <br> Фактическое время включения: 14.09.2017 11:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Энергетиков ул 30\",\"content\":\"Энергетиков,26 глушение в-да д-50мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 17:00:00 <br> Фактическое время отключения: 14.09.2017 09:15:00 <br> Фактическое время включения: 14.09.2017 11:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Энергетиков ул 30а\",\"content\":\"Энергетиков,26 глушение в-да д-50мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 17:00:00 <br> Фактическое время отключения: 14.09.2017 09:15:00 <br> Фактическое время включения: 14.09.2017 11:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Трубников ул 25\",\"content\":\"Энергетиков,26 глушение в-да д-50мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 17:00:00 <br> Фактическое время отключения: 14.09.2017 09:15:00 <br> Фактическое время включения: 14.09.2017 11:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Трубников ул 27\",\"content\":\"Энергетиков,26 глушение в-да д-50мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 17:00:00 <br> Фактическое время отключения: 14.09.2017 09:15:00 <br> Фактическое время включения: 14.09.2017 11:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Трубников ул 29\",\"content\":\"Энергетиков,26 глушение в-да д-50мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 17:00:00 <br> Фактическое время отключения: 14.09.2017 09:15:00 <br> Фактическое время включения: 14.09.2017 11:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Кудрявцева ул 81а\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Кудрявцева ул 81б\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Кудрявцева ул 77\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Кудрявцева ул 79\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Кудрявцева ул 81\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Кудрявцева ул 83\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Кудрявцева ул 83а\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Артиллерийская ул 106\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Артиллерийская ул 108\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Артиллерийская ул 110\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Артиллерийская ул 112\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Артиллерийская ул 114\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Артиллерийская ул 114а\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Артиллерийская ул 114б\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Артиллерийская ул 116\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Артиллерийская ул 116а\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Артиллерийская ул 116б\",\"content\":\"Кудрявцева,81а замена водовода д-100мм, L-10м и з-ки д-150мм - Плановые <br> Плановое время отключения: 14.09.2017 09:00:00 <br> Плановое время включения: 14.09.2017 20:00:00 <br> Фактическое время отключения: 14.09.2017 10:00:00 <br> Фактическое время включения: 14.09.2017 18:30:00\",\"type\":\"green\"}],\"15 Сентября\":[{\"coordinates\":[61.374544,55.142154],\"name\":\"Захаренко ул 13\",\"content\":\"Захаренко 13 переврезки на водоводе д-200 - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Захаренко ул 13а\",\"content\":\"Захаренко 13 переврезки на водоводе д-200 - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Комсомольский пр-кт 34в\",\"content\":\"Комсомольский пр., 36в замена 2-х задвижек д-100 мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Комсомольский пр-кт 34д\",\"content\":\"Комсомольский пр., 36в замена 2-х задвижек д-100 мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Комсомольский пр-кт 36\",\"content\":\"Комсомольский пр., 36в замена 2-х задвижек д-100 мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Комсомольский пр-кт 36а\",\"content\":\"Комсомольский пр., 36в замена 2-х задвижек д-100 мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Комсомольский пр-кт 36б\",\"content\":\"Комсомольский пр., 36в замена 2-х задвижек д-100 мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Комсомольский пр-кт 36в\",\"content\":\"Комсомольский пр., 36в замена 2-х задвижек д-100 мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Комсомольский пр-кт 38а\",\"content\":\"Комсомольский пр., 36в замена 2-х задвижек д-100 мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Комсомольский пр-кт 38б\",\"content\":\"Комсомольский пр., 36в замена 2-х задвижек д-100 мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Куйбышева ул 49\",\"content\":\"Комсомольский пр., 36в замена 2-х задвижек д-100 мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"40-летия Победы ул 33\",\"content\":\"ул.40-летия Победы 33а устранение повреждения на водоводе д-150 мм - Плановые <br> Плановое время отключения: 15.09.2017 10:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"40-летия Победы ул 33а\",\"content\":\"ул.40-летия Победы 33а устранение повреждения на водоводе д-150 мм - Плановые <br> Плановое время отключения: 15.09.2017 10:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"40-летия Победы ул 33б\",\"content\":\"ул.40-летия Победы 33а устранение повреждения на водоводе д-150 мм - Плановые <br> Плановое время отключения: 15.09.2017 10:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"40-летия Победы ул 35\",\"content\":\"ул.40-летия Победы 33а устранение повреждения на водоводе д-150 мм - Плановые <br> Плановое время отключения: 15.09.2017 10:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"40-летия Победы ул 35а\",\"content\":\"ул.40-летия Победы 33а устранение повреждения на водоводе д-150 мм - Плановые <br> Плановое время отключения: 15.09.2017 10:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"250-летия Челябинска ул 8\",\"content\":\"ул.40-летия Победы 33а устранение повреждения на водоводе д-150 мм - Плановые <br> Плановое время отключения: 15.09.2017 10:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"250-летия Челябинска ул 10\",\"content\":\"ул.40-летия Победы 33а устранение повреждения на водоводе д-150 мм - Плановые <br> Плановое время отключения: 15.09.2017 10:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Гранитная ул 7\",\"content\":\"ул.Гранитная,7 замена  водовода д-100мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Трубников ул 9\",\"content\":\"ул.Гранитная,7 замена  водовода д-100мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Трубников ул 11\",\"content\":\"ул.Гранитная,7 замена  водовода д-100мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Трубников ул 13\",\"content\":\"ул.Гранитная,7 замена  водовода д-100мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Трубников ул 15\",\"content\":\"ул.Гранитная,7 замена  водовода д-100мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Трубников ул 17\",\"content\":\"ул.Гранитная,7 замена  водовода д-100мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Сони Кривой ул 59\",\"content\":\"ул.С.Кривой 61 ремонтные работы на водоводе д-100мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 18:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Сони Кривой ул 61\",\"content\":\"ул.С.Кривой 61 ремонтные работы на водоводе д-100мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 18:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Сони Кривой ул 63\",\"content\":\"ул.С.Кривой 61 ремонтные работы на водоводе д-100мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 18:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Сони Кривой ул 65\",\"content\":\"ул.С.Кривой 61 ремонтные работы на водоводе д-100мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 18:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Сони Кривой ул 65а\",\"content\":\"ул.С.Кривой 61 ремонтные работы на водоводе д-100мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 18:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Сони Кривой ул 67\",\"content\":\"ул.С.Кривой 61 ремонтные работы на водоводе д-100мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 18:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Кудрявцева ул 81а\",\"content\":\"Кудрявцева,81а замена водовода д-100 мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Кудрявцева ул 81б\",\"content\":\"Кудрявцева,81а замена водовода д-100 мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"},{\"coordinates\":[61.374544,55.142154],\"name\":\"Кудрявцева ул 77\",\"content\":\"Кудрявцева,81а замена водовода д-100 мм - Плановые <br> Плановое время отключения: 15.09.2017 09:00:00 <br> Плановое время включения: 15.09.2017 20:00:00 <br> Фактическое время отключения:  <br> Фактическое время включения: \",\"type\":\"blue\"}]}";
        HashMap<String, String> strings = searchAndReplaceDate(message);
        Gson gson = new Gson();
        DataVoda dataVoda = gson.fromJson(strings.get("rezult"), DataVoda.class);
        ArrayList<NewsItem> newsItems = new ArrayList<>();
        createItems(dataVoda.date1, newsItems, strings.get("date1"));
        createItems(dataVoda.date2, newsItems, strings.get("date2"));
        createItems(dataVoda.date3, newsItems, strings.get("date3"));
        if (!searchWord.trim().isEmpty()) {
            newsItems.removeIf(newsItem -> !newsItem.getName().toLowerCase().contains(searchWord.toLowerCase()));
        }
        return newsItems.toArray(new NewsItem[newsItems.size()]);
    }

    private void createItems(List<? extends DataVoda.DatesData> list, List<NewsItem> newsItems, String date) {
        if (date != null && !date.isEmpty()) {
            int year = new Date().getYear();
            for (DataVoda.DatesData dat : list) {
                Date dateFromData;
                synchronized (dateFormat) {
                    try {
                        dateFromData = dateFormat.parse(date);
                        dateFromData.setYear(year);
                    } catch (ParseException e) {
                        dateFromData = new Date();
                    }
                }
                newsItems.add(new NewsItem(dat.name, dat.name + "\n" + String.valueOf(dateFromData.getTime()), 0, "", dateFromData.getTime()));
            }
        }
    }

    @Override
    public NewsPage getNewsPage(PageRequest pageRequest) throws Exception {
        int year = new Date().getYear();
        String name = pageRequest.getUrl().split("\n")[0];
        long date = Long.parseLong(pageRequest.getUrl().split("\n")[1]);
        Document document = getDocument(ConstantManager.VODA_UU_RU);
        String message = document.getElementsByTag("script").get(15).html().split("\n")[1];
        message = message.replaceFirst("objects:", "").trim();
        message = message.substring(0, message.length() - 1);
        HashMap<String, String> strings = searchAndReplaceDate(message);
        Gson gson = new Gson();
        String content = "";
        Date date11 = new Date();
        Date date22 = new Date();
        Date date33 = new Date();
        synchronized (dateFormat) {
            try {
                date11 = dateFormat.parse(strings.get("date1"));
                date22 = dateFormat.parse(strings.get("date2"));
                date33 = dateFormat.parse(strings.get("date3"));
            } catch (Exception e) {

            }
        }
        date11.setYear(year);
        date22.setYear(year);
        date33.setYear(year);
        DataVoda dataVoda = gson.fromJson(strings.get("rezult"), DataVoda.class);
        if (date11.getTime() == (date)) {
            content = getContent(dataVoda.date1, name);
        }
        if (date22.getTime() == (date)) {
            content = getContent(dataVoda.date2, name);
        }
        if (date33.getTime() == (date)) {
            content = getContent(dataVoda.date3, name);
        }
        return new NewsPage(name + "\n" + dateFormat.format(new Date(date)), null, content, null, null, null, null);
    }

    private String getContent(List<? extends DataVoda.DatesData> list, String name) {
        for (DataVoda.DatesData dat : list) {
            if (dat.name.equals(name)) {
                return dat.content.replaceAll("<br>", "\n");
            }
        }
        return ConstantManager.ERRORDOWNLOADPAGE;
    }

    private Document getDocument(String url) {
        Document document;
        try {
            document = Jsoup.connect(url).timeout(60000).get();
        } catch (IOException e) {
            document = null;
        }
        return document;
    }

    private HashMap<String, String> searchAndReplaceDate(String string) {
        int[] words = new int[6];
        words[0] = string.indexOf("\"");//начало первого слова
        words[1] = string.indexOf("\"", words[0] + 1);//конец первого слова
        int temp = nextWord(string.indexOf("["), string);
        words[2] = string.indexOf("\"", temp);
        words[3] = string.indexOf("\"", words[2] + 1);
        temp = nextWord(string.indexOf("[", words[3]), string);
        words[4] = string.indexOf("\"", temp);
        words[5] = string.indexOf("\"", words[4] + 1);
        HashMap<String, String> dateMap = new HashMap<>();
        if (string.substring(words[0] + 1, words[1]).length() > 2)
            dateMap.put("date1", string.substring(words[0] + 1, words[1]));
        if (string.substring(words[2] + 1, words[3]).length() > 2)
            dateMap.put("date2", string.substring(words[2] + 1, words[3]));
        if (string.substring(words[4] + 1, words[5]).length() > 2)
            dateMap.put("date3", string.substring(words[4] + 1, words[5]));
        for (String key : dateMap.keySet()) {
            string = string.replace(dateMap.get(key), key);
        }
        dateMap.put("rezult", string);
        return dateMap;
    }

    private int nextWord(int currentChar, String string) {
        char[] chars = string.toCharArray();
        int schet = 0;
        int next = 0;
        for (int i = currentChar; i < chars.length; i++) {
            if (chars[i] == '[') schet++;
            if (chars[i] == ']') schet--;
            if (schet == 0) {
                next = i;
                break;
            }
        }
        return next;
    }

   /* public static void main(String[] args) throws Exception {
        VodaUU vodaUU = new VodaUU();
        NewsItem[] items = vodaUU.getItems("");
        for (int i = 0; i < items.length; i++) {

        }
        NewsItem item = items[items.length - 1];
        System.out.println(item);
        System.out.println(vodaUU.getNewsPage(new PageRequest(item.getLink(), "voda")));

    }*/
}
